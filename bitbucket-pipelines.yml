image:
  name: maven:3.8.2-openjdk-16

options:
  docker: true

definitions:
  services:
    chrome:
      image: selenium/standalone-chrome:92.0-20210823
    firefox:
      image: selenium/standalone-firefox:91.0-20210823
  steps:
    - step: &run-staging
        name: Run staging tests
        caches:
          - maven
        script:
          - export MINDRQA_ACCOUNTS_PASSWORD=$MINDRQA_STAGING_ACCOUNT_PASSWORD
          - export MINDRQA_GMAIL_PASSWORD=$MINDRQA_STAGING_GMAIL_PASSWORD
          - export MINDRQA_EMAIL=$MINDRQA_STAGING_EMAIL
          - mvn -Pstaging -Psuite -Premote-chrome test -DsuiteFile=regression.xml
        services:
          - chrome
        artifacts:
          - target/screenshots/*.png
    - step: &run-production
        name: Run production tests
        caches:
          - maven
        script:
          - export MINDRQA_ACCOUNTS_PASSWORD=MindrGlobal\!23
          - export MINDRQA_GMAIL_PASSWORD=$MINDRQA_GMAIL_PASSWORD
          - export MINDRQA_EMAIL=mindrqa@gmail.com
          - mvn -Psuite -Premote-chrome test -DsuiteFile=regression.xml
        services:
          - chrome
        artifacts:
          - target/screenshots/*.png
pipelines:
  default:
    - step: *run-staging
  branches:
    master:
      - step: *run-production
  custom:
    staging-tests:
      - step: *run-staging
    production-tests:
      - step: *run-production
